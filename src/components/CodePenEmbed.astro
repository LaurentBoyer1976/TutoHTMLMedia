---
interface Props {
  code: string;
  titre: string;
}

const { code, titre } = Astro.props;

// Cr√©er un ID unique pour l'iframe
const iframeId = `codepen-${Math.random().toString(36).substring(7)}`;
---

<div class="codepen-embed">
  <h4>{titre}</h4>
  
  <details class="codepen-details">
    <summary>üìù Voir le code source</summary>
    <pre><code>{code}</code></pre>
  </details>

  <details class="codepen-interactive">
    <summary>üé® Tester l'exemple interactif</summary>
    <div class="iframe-container">
      <iframe
        id={iframeId}
        title={titre}
        loading="lazy"
        allowtransparency="true"
        allowfullscreen="true"
        class="codepen-iframe"
      ></iframe>
      <script is:inline define:vars={{ iframeId: iframeId, code }}>
        {
          // @ts-ignore
          const iframe = document.getElementById(iframeId);
          const htmlContent = `
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
  </style>
</head>
<body>
  ${code}
</body>
</html>`;
          
          iframe.srcdoc = htmlContent;
        }
      </script>
    </div>
    <a 
      href={`https://codepen.io/pen?editors=1000`}
      target="_blank" 
      rel="noopener noreferrer"
      class="open-codepen"
    >
      Ouvrir dans CodePen (√©ditable) ‚Üí
    </a>
  </details>
</div>

<style>
  .codepen-embed {
    margin: 1.5rem 0;
    padding: 1rem;
    background: #2a2a2a;
    border-radius: 0.5rem;
    border: 1px solid #333;
  }

  .codepen-embed h4 {
    margin: 0 0 1rem 0;
    color: #667eea;
  }

  .codepen-details,
  .codepen-interactive {
    margin: 1rem 0;
    background: #1a1a1a;
    border-radius: 0.5rem;
    padding: 0.5rem;
  }

  .codepen-details summary,
  .codepen-interactive summary {
    cursor: pointer;
    padding: 0.8rem;
    color: #667eea;
    font-weight: 500;
    user-select: none;
  }

  .codepen-details summary:hover,
  .codepen-interactive summary:hover {
    color: #764ba2;
  }

  .codepen-details pre {
    background: #0d0d0d;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1rem 0 0 0;
  }

  .codepen-details code {
    color: #50fa7b;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
  }

  .iframe-container {
    margin: 1rem 0;
    background: white;
    border-radius: 0.5rem;
    overflow: hidden;
    border: 2px solid #667eea;
  }

  .codepen-iframe {
    width: 100%;
    min-height: 300px;
    border: none;
    display: block;
  }

  .open-codepen {
    display: inline-block;
    margin: 1rem 0;
    padding: 0.8rem 1.5rem;
    background: #667eea;
    color: white;
    text-decoration: none;
    border-radius: 0.5rem;
    font-weight: 500;
    transition: all 0.3s;
  }

  .open-codepen:hover {
    background: #764ba2;
    transform: translateY(-2px);
  }

  @media (prefers-color-scheme: light) {
    .codepen-embed {
      background: #e9e9e9;
      border-color: #ddd;
    }

    .codepen-details,
    .codepen-interactive {
      background: #f9f9f9;
    }

    .codepen-details pre {
      background: #f0f0f0;
    }

    .codepen-details code {
      color: #2ecc71;
    }
  }
</style>